<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Medical Report AI System</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Merriweather:wght@300;400;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>

<body>
    <div class="app-container">
        <!-- Sidebar / Input Section -->
        <aside class="sidebar">
            <div class="brand">
                <div class="brand-icon">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5" />
                    </svg>
                </div>
                <span>MedAI Report</span>
            </div>

            <!-- Navigation Tabs -->
            <div class="nav-tabs"
                style="display: flex; gap: 1rem; margin-bottom: 1rem; border-bottom: 1px solid var(--border);">
                <button id="newReportTab" class="tab-btn active"
                    style="padding: 0.5rem; border: none; background: none; cursor: pointer; font-weight: 600; color: var(--primary); border-bottom: 2px solid var(--primary);">New
                    Report</button>
                <button id="historyTab" class="tab-btn"
                    style="padding: 0.5rem; border: none; background: none; cursor: pointer; font-weight: 600; color: var(--text-muted);">History</button>
            </div>

            <!-- New Report View -->
            <div id="newReportView">
                <div class="input-group">
                    <label>Patient Name</label>
                    <input type="text" id="patientName" class="input-field" placeholder="Enter patient name">
                </div>

                <div class="input-group">
                    <label>Examination Date</label>
                    <input type="date" id="examDate" class="input-field">
                </div>

                <div class="input-group">
                    <label>Clinical Indication</label>
                    <textarea id="clinicalIndication" class="input-field" rows="3"
                        placeholder="Symptoms, history...">Routine checkup</textarea>
                </div>

                <div class="upload-zone" id="dropZone">
                    <input type="file" id="imageInput" accept="image/*" hidden>
                    <div class="upload-icon">üìÅ</div>
                    <p style="font-weight: 500;">Click or Drop X-Ray Here</p>
                    <p style="font-size: 0.8rem; color: var(--text-muted); margin-top: 0.5rem;">Supports DICOM, PNG, JPG
                    </p>
                    <div id="fileInfo"
                        style="display: none; margin-top: 1rem; padding: 0.5rem; background: #f1f5f9; border-radius: 0.5rem;">
                        <p id="fileName" style="font-size: 0.8rem; word-break: break-all;"></p>
                    </div>
                </div>

                <button id="analyzeBtn" class="btn-primary" disabled>
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="11" cy="11" r="8"></circle>
                        <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                    </svg>
                    Generate Report
                </button>
            </div>

            <!-- History View -->
            <div id="historyView" style="display: none; height: 100%; overflow: hidden; flex-direction: column;">
                <div class="input-group" style="margin-bottom: 1rem;">
                    <input type="text" id="searchInput" class="input-field" placeholder="Search by name or date...">
                </div>
                <div id="historyList"
                    style="flex: 1; overflow-y: auto; display: flex; flex-direction: column; gap: 0.5rem;">
                    <!-- History items will be populated here -->
                </div>
            </div>
        </aside>

        <!-- Main Content / Report Section -->
        <main class="main-content">
            <div class="report-header">
                <div class="report-title">
                    <h1>Radiological Report</h1>
                    <p style="color: var(--text-muted);">AI-Assisted Analysis</p>
                </div>
                <div class="report-meta">
                    <div>
                        <span
                            style="display: block; font-size: 0.75rem; text-transform: uppercase; color: var(--text-muted);">Date</span>
                        <span id="reportDate" style="font-weight: 600; color: var(--text-main);"></span>
                    </div>
                    <div>
                        <span
                            style="display: block; font-size: 0.75rem; text-transform: uppercase; color: var(--text-muted);">Status</span>
                        <span style="font-weight: 600; color: var(--success);">Finalized</span>
                    </div>
                </div>
            </div>

            <div class="report-body">
                <!-- Left Column: Report Text -->
                <div class="report-left">
                    <div id="resultsSection" style="display: none;">
                        <div class="report-section">
                            <div class="section-title">Findings & Impression</div>
                            <div id="reportText" class="report-text"></div>
                        </div>

                        <div class="report-section">
                            <div class="section-title">AI Detection Probabilities</div>
                            <div id="findingsList" class="findings-list"></div>
                        </div>

                        <div class="chat-interface">
                            <div class="section-title">Clinical Q&A</div>
                            <div id="chatMessages" class="chat-messages"></div>
                            <div style="display: flex; gap: 0.5rem;">
                                <input type="text" id="questionInput" class="input-field"
                                    placeholder="Ask about the image..." style="flex: 1;">
                                <button id="askBtn" class="btn-primary" style="padding: 0.75rem;">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                        stroke-width="2">
                                        <line x1="22" y1="2" x2="11" y2="13"></line>
                                        <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
                                    </svg>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Initial State Message -->
                    <div id="initialState" style="text-align: center; padding: 4rem; color: var(--text-muted);">
                        <p>Upload an X-ray image and click "Generate Report" to begin analysis.</p>
                    </div>
                </div>

                <!-- Right Column: Image Display -->
                <div class="report-right">
                    <div class="xray-display">
                        <img id="previewImage" class="xray-image" style="display: none;">
                        <div class="scanner"></div>
                        <div id="loadingOverlay" class="loading-overlay">
                            <div
                                style="width: 40px; height: 40px; border: 3px solid var(--border); border-top-color: var(--primary); border-radius: 50%; animation: spin 1s linear infinite; margin-bottom: 1rem;">
                            </div>
                            <p style="font-weight: 600; color: var(--primary);">Analyzing...</p>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
    <style>
        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }
    </style>
    <script>
        // Simple logic to hide initial state when results are shown
        const observer = new MutationObserver((mutations) => {
            mutations.forEach((mutation) => {
                if (mutation.target.style.display !== 'none') {
                    document.getElementById('initialState').style.display = 'none';
                }
            });
        });
        observer.observe(document.getElementById('resultsSection'), { attributes: true, attributeFilter: ['style'] });
    </script>
</body>

</html>